<!DOCTYPE html>
<html>
<head>
<title>Johans enhörningsdatabas</title>
<meta charset="UTF-8">
<style type="text/css">
table {
  border-spacing: 10px;
  border-collapse: separate;
  cellspacing: 100px;
  width: 1200px;
}
td {
  border: 1px solid black;
  padding: 10px;
}
li {
  cursor: pointer;
}
/*
 * Bilden på enhörningen blir lätt för stor. Det kan vi ordna genom att,
 * exempelvis, bestämma bredden på list och #info.
 */
#unicornImage img {
  max-width: 800px;
}
/*
 * I samma veva kan vi sätta bredden på #list till ett fast värde så att den
 * inte ändrar storlek hela tiden.
 */
#list {
  width: 300px;
}
</style>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<script type="text/javascript">

function fetchAndUpdateInfo(details) {
  return function() {
    $.ajax({
      url: details,
      headers: {"Accept": "application/json"}
    })
    .done(function (data) {
      /*
       * spottedWhen tolkas av Javascript som en sträng, inte som ett
       * Date-objekt. Däremot kan vi använda  strängen för att skapa ett
       * Date-objekt.
       */
      date = new Date(data['spottedWhen']);
      
      /*
       * Det här blir texten som vi visar längst ner på sidan.
       */
      sighting = 'Av: ' + data['reportedBy'] + ', '
               + date.toLocaleDateString() // Den här funktionen gör om datum-
                                           // objektet till en sträng på det
                                           // format (åååå-mm-dd) som vi vill ha.
               + ' i ' + data['spottedWhere']['name'];
      
      /*
       * Med funktionen $().text() kan man ändra ett specifikt elements text.
       * Vi börjar med att ändra namnet på enhörningen.
       */
      $('#unicornName').text(data['name']);
      
      /*
       * Eftersom vi lägger in HTML fungerar inte text. Här måste vi använda
       * oss av jQuerys $().html() istället.
       */
      $('#unicornImage').html('<img src="' + data['image'] + '">');
      $('#unicornInfo').text(data['description']);
      $('#unicornSighting').text(sighting);
    });
  }
}


$(document).ready(function () {
  const twitterStuff = ['@Lenamalmstrom Eller hur 😀', '@MsMoneypenny11 @msgrp Nä, han sa ju no filter 🤣', 'Carl har bryggt kaffe.. smakar sump.. men lär ju dricka upp de, som den snälla flickvännen man är 🥲', '(SWE/ENG) Grind med packs o annat skoj! #ad !cantona !messi !grannen #FuckCorona https://t.co/kUd1t3NhDT', '@svtnyheter Är man förvånad, knappast! Sen ett nytt begrepp "Iskyla" Ha Ha', '@Natursidan Bedrövligt!', '@Newbergskan Eller hur 😀', '@thereseverdun Min mamma jobbade i Saltsjöqvarn när jag var liten och som på den tiden var kungsörnen.', '@AryaStark_got_ För mycket snö är precis lagom', 'Alla älskar snö https://t.co/PG7Z5q1Flr']
 // FIXA EN SÖKBAR, just nu tar ni bara allt dom har, ta funktionen LOGGA från din andra sida
  $.ajax({
    url: "https://polisen.se/api/events",
    headers: {"Accept": "application/json"}
  })
  .done(function (data) { 
    list = $('#unicorns');
    console.log(data[1]);
    for (i = 0; i < data.length; i++) {
      html = '<li id="police_post_' + i + '">' + data[i]['name'] + '</li>';
      list.append(html);
      $('#police_post_' + i).click(updatePoliceDiv(data[i]));
    }
  });

  function getTwitterPosts (gps) {
    // $.ajax({
    //   url: "JAVAROUTEN TILL TWITTER API + gps",
    //   headers: {"Accept": "application/json"}
    // })
    // .done(function (data) { 
    //   return data.body ANTAGLIGEN DATA.BODY, logga data om det inte är det för att titta;
    // });
    return twitterStuff;
  } 
  
  function updateTwitterDiv(twitterPosts) {
    console.log(twitterPosts[0]);
    console.log(twitterPosts[1]);
    console.log(twitterPosts[2]);
    // Loopa ut alla kommentarerna i en LI eller liknande beroende på hur du vill visa dom och appenda till diven till höger som är gjort för twitter
  }

  function updatePoliceDiv(data) {
    return function () {
      console.log(data.location.gps);
      var gps = data.location.gps;
      console.log(data.location.name);
      var locationName = data.name;
      console.log(data.name);
      var name = data.name;
      console.log(data.summary);
      var summary = data.summary;
      console.log(data.url);
      var url = data.url;
      console.log(data.type);
      var type = data.type;
      console.log(data.datetime);
      var dateTime = data.datetime;
      // appenda informationen till diven som du gjort till höger för polisen
      // ta bort allt innan
      $("#eventName").empty();
      something = '<h3>' + data.name + '</h3>';
      $("#eventName").append(something);

      $("#eventInfo").empty();
      something2 = '<p>' + data.summary + '</p>';
      $("#eventName").append(something2);

      $("#eventUrl").empty();
      something3 = '<a src="' + data.url + '">' + data.url + '</a>';
      $("#eventUrl").append(something3);


      // lägg till grejer
      // https://www.w3schools.com/jquery/jquery_dom_add.asp




      var twitterPosts = getTwitterPosts(data.location.gps);
      updateTwitterDiv(twitterPosts);
    }
  }
});
</script>
</head>
<body>
<h1>Johans enhörningsdatabas</h1>
<table>
  <tr>
    <td id="list">
      <ul id="unicorns">
      </ul>
    </td>
    <td id="info">
      <h2 id="eventName">Event namn</h2>
      <span id="eventInfo"></span>
      <p id="eventUrl"></p>
    </td>
  </tr>
</table>
</body>
</html>
